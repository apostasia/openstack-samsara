# - name: Create Samsara user
#   environment: "{{ admin_env }}"
#   os_user:
#       - state: present
#       - name: samsara
#       - password: "{{ samsara_password }}"
#       - domain: default
#       - default_project: service

- name: Create samsara user
  environment: "{{ admin_env }}"
  command: openstack user create --password "{{ samsara_password }}" samsara
  run_once: true

- name: Add admin role to nova user and service project
  environment: "{{ admin_env }}"
  command: openstack role add --project service --user samsara admin
  run_once: true

- name: Create Service Entity Nova
  environment: "{{ admin_env }}"
  command: openstack service create --name samsara --description "OpenStack Samsara" workload
  run_once: true

# - name: Create Nova Service Endpoint
#   environment: "{{ admin_env }}"
#   command: openstack endpoint create --publicurl http://controller:8774/v2/%\(tenant_id\)s --internalurl http://controller:8774/v2/%\(tenant_id\)s --adminurl http://controller:8774/v2/%\(tenant_id\)s --region RegionOne compute
#   run_once: true

### Create Flavor

- name: Create Nano flavor
  environment: "{{ admin_env }}"
  shell: nova flavor-create --is-public true m1.nano auto 256 1 1

- name: Create Pico flavor
  environment: "{{ admin_env }}"
  shell: nova flavor-create --is-public true m1.pico auto 128 1 1

# Create 'Nano' flavor with 256MB of RAM, 1 virtual CPU, and 0GB of
# local disk, and 0GB of ephemeral.
# - name: Create Nano flavor
#   os_nova_flavor:
#       - state: present
#       - name: m1.nano
#       - ram: 256
#       - vcpus: 1
#       - disk: 0
#       - ephemeral: 0
#
# # Create 'Pico' flavor with 128MB of RAM, 1 virtual CPU, and 0GB of
# # local disk, and 0GB of ephemeral.
# - name: Create Pico flavor
#   os_nova_flavor:
#       - state: present
#       - name: m1.pico
#       - ram: 128
#       - vcpus: 1
#       - disk: 0
#       - ephemeral: 0
#       - is_public: True
